<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USGS 지진 지도</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.js"></script>
    <style>
        /* 기존 스타일 유지 */
        /* ... */

        .factory-icon {
            width: 24px;
            height: 24px;
        }

        .cluster-animation {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- 기존 HTML 구조 유지 -->
    <!-- ... -->

    <script>
        // 기존 JavaScript 코드 유지
        // ...

        // 공장 아이콘 정의 (SVG 형식의 공장 아이콘)
        var factoryIcon = L.divIcon({
            html: `<svg class="factory-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 20V9.5L7 12V9L12 11.5V9L17 11.5V7L22 9.5V20H2Z" fill="#3498db" stroke="#2980b9" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M5 20V15H8V20" fill="#34495e" stroke="#2c3e50" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M14 20V15H17V20" fill="#34495e" stroke="#2c3e50" stroke-width="2" stroke-linejoin="round"/>
                   </svg>`,
            className: 'factory-icon',
            iconSize: [24, 24],
            iconAnchor: [12, 12]
        });

        // 지도 업데이트 함수 수정
        function updateMap() {
            markers.clearLayers();
            let countries = new Set();

            earthquakeData.forEach(feature => {
                var coords = feature.geometry.coordinates;
                var mag = feature.properties.mag;
                var place = feature.properties.place;
                var time = new Date(feature.properties.time).toLocaleString();
                var country = place.split(', ').pop();

                countries.add(country);

                var marker = L.marker([coords[1], coords[0]], {icon: factoryIcon})
                    .bindPopup(`
                        <div class="info-box">
                            <h4>지진 정보</h4>
                            <p><strong>위치:</strong> ${place}</p>
                            <p><strong>규모:</strong> ${mag}</p>
                            <p><strong>시간:</strong> ${time}</p>
                            <p><strong>위도:</strong> ${coords[1]}</p>
                            <p><strong>경도:</strong> ${coords[0]}</p>
                            <button class="close-btn">닫기</button>
                        </div>
                    `, {
                        closeButton: false,
                        closeOnClick: false
                    });

                marker.on('popupopen', function() {
                    var closeButton = document.querySelector('.close-btn');
                    closeButton.addEventListener('click', function() {
                        map.closePopup();
                    });
                    document.getElementById('countrySelect').value = '';
                });

                markers.addLayer(marker);
            });

            map.addLayer(markers);

            // 국가 선택 옵션 업데이트 (기존 코드 유지)
            // ...
        }

        // 클러스터 클릭 이벤트 수정 (애니메이션 추가)
        markers.on('clusterclick', function(a) {
            var bounds = a.layer.getBounds();
            map.flyToBounds(bounds, {
                animate: true,
                duration: 1.5
            });
            
            // 애니메이션 효과 추가
            var clusterIcon = a.layer.getIcon();
            clusterIcon.options.className += ' cluster-animation';
            a.layer.setIcon(clusterIcon);
            
            setTimeout(() => {
                clusterIcon.options.className = clusterIcon.options.className.replace(' cluster-animation', '');
                a.layer.setIcon(clusterIcon);
            }, 500);

            document.getElementById('countrySelect').value = '';
        });

        // 기존의 나머지 코드 유지
        // ...
    </script>
</body>
</html>