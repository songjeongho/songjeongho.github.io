<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>USGS Earthquake Data</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search/dist/leaflet-search.src.css"/>
    <style>
        #map {
            height: 80vh;
            width: 100%;
        }
        #status-bar {
            height: 20px;
            background-color: #f8f9fa;
            padding: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="status-bar">
        <div id="earthquake-status">Loading earthquake data...</div>
        <div id="coordinates"></div>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-search/dist/leaflet-search.src.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 지도를 초기화합니다.
            const map = L.map('map').setView([37.7749, -122.4194], 5);

            // OpenStreetMap 타일 레이어를 추가합니다.
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap'
            }).addTo(map);

            // 상태바와 위도 경도 정보를 표시하는 요소를 가져옵니다.
            const earthquakeStatus = document.getElementById('earthquake-status');
            const coordinates = document.getElementById('coordinates');

            // 지진 데이터를 가져옵니다.
            fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson')
                .then(response => response.json())
                .then(data => {
                    const geoJsonLayer = L.geoJSON(data, {
                        onEachFeature: function (feature, layer) {
                            layer.bindPopup(`
                                <strong>Location:</strong> ${feature.properties.place}<br>
                                <strong>Magnitude:</strong> ${feature.properties.mag}<br>
                                <strong>Time:</strong> ${new Date(feature.properties.time).toLocaleString()}
                            `);
                        },
                        pointToLayer: function (feature, latlng) {
                            return L.marker(latlng);
                        }
                    }).addTo(map);

                    // Leaflet Search 기능을 추가합니다.
                    const searchControl = new L.Control.Search({
                        layer: geoJsonLayer,
                        propertyName: 'place',
                        marker: false,
                        moveToLocation: function(latlng) {
                            map.setView(latlng, 10); // 검색된 위치로 이동합니다.
                        }
                    });
                    searchControl.addTo(map);

                    // 지진 데이터 상태 업데이트
                    earthquakeStatus.textContent = `Total Earthquakes: ${data.features.length}`;
                })
                .catch(error => {
                    earthquakeStatus.textContent = 'Error loading earthquake data';
                    console.error('Error fetching earthquake data:', error);
                });

            // 마우스 움직임에 따른 위도 경도를 상태바에 표시합니다.
            map.on('mousemove', function(e) {
                coordinates.textContent = `Latitude: ${e.latlng.lat.toFixed(4)}, Longitude: ${e.latlng.lng.toFixed(4)}`;
            });
        });
    </script>
</body>
</html>