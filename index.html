<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earthquake Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        #map { height: 600px; }
        #status-bar { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            background-color: #f8f9fa; 
            padding: 10px; 
            border-top: 1px solid #ddd; 
            display: flex; 
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="status-bar">
        <div id="message">Loading...</div>
        <div id="coords"></div>
    </div>
    <button id="reset-view" class="btn btn-primary" style="position: fixed; top: 10px; right: 10px;">Reset View</button>
    <div class="container mt-4">
        <div class="row">
            <div class="col">
                <h3>Earthquake Data</h3>
                <div id="table-info"></div>
                <table id="earthquake-table" class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Location</th>
                            <th>Magnitude</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script>
        const map = L.map('map').setView([37.7749, -122.4194], 5);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        const resetViewBtn = document.getElementById('reset-view');
        resetViewBtn.addEventListener('click', () => {
            map.setView([37.7749, -122.4194], 5);
        });

        L.Control.geocoder().addTo(map);

        const statusBar = document.getElementById('status-bar');
        const messageDiv = document.getElementById('message');
        const coordsDiv = document.getElementById('coords');

        map.on('mousemove', function(e) {
            coordsDiv.innerHTML = `Lat: ${e.latlng.lat.toFixed(4)}, Lng: ${e.latlng.lng.toFixed(4)}`;
        });

        function fetchEarthquakeData() {
            messageDiv.innerHTML = 'Fetching earthquake data...';
            fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson')
                .then(response => response.json())
                .then(data => {
                    displayEarthquakes(data.features);
                    displayTable(data.features);
                    messageDiv.innerHTML = 'Data loaded successfully';
                })
                .catch(error => {
                    console.error('Error fetching earthquake data:', error);
                    messageDiv.innerHTML = 'Error loading data';
                });
        }

        function displayEarthquakes(earthquakes) {
            earthquakes.forEach(eq => {
                const coords = [eq.geometry.coordinates[1], eq.geometry.coordinates[0]];
                const magnitude = eq.properties.mag;
                const place = eq.properties.place;
                const time = new Date(eq.properties.time).toLocaleString();

                const marker = L.marker(coords).addTo(map);
                marker.bindPopup(`<b>Location:</b> ${place}<br><b>Magnitude:</b> ${magnitude}<br><b>Time:</b> ${time}`);
            });
        }

        function displayTable(earthquakes) {
            const tableBody = document.querySelector('#earthquake-table tbody');
            tableBody.innerHTML = '';
            earthquakes.forEach(eq => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${eq.id}</td>
                    <td>${eq.properties.place}</td>
                    <td>${eq.properties.mag}</td>
                    <td>${new Date(eq.properties.time).toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });

            document.getElementById('table-info').innerHTML = `Total Records: ${earthquakes.length}`;
        }

        setInterval(fetchEarthquakeData, 300000); // Fetch data every 5 minutes
        fetchEarthquakeData(); // Initial fetch

    </script>
</body>
</html>