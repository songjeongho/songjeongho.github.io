<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Earthquake Information Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        #map {
            height: 600px;
            width: 70%;
            float: left;
        }
        #earthquakeTable {
            width: 30%;
            float: right;
            overflow-y: auto;
            max-height: 600px;
        }
        #statusBar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #f1f1f1;
            padding: 10px;
            border-top: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="earthquakeTable" class="table-responsive"></div>
    <div id="statusBar" class="d-flex justify-content-between">
        <span id="latlong"></span>
        <span id="updateStatus"></span>
    </div>
    
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([37.7749, -122.4194], 5);

        // Add tile layer to the map
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        // Function to fetch earthquake data
        async function fetchEarthquakeData() {
            const response = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson');
            const data = await response.json();
            return data;
        }

        // Function to update earthquake markers and table
        async function updateEarthquakeInfo() {
            const data = await fetchEarthquakeData();
            const earthquakes = data.features;

            // Clear existing markers and table content
            map.eachLayer((layer) => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });
            $('#earthquakeTable').empty();

            // Add markers to the map
            earthquakes.forEach((quake, index) => {
                const coords = quake.geometry.coordinates;
                const lat = coords[1];
                const lng = coords[0];
                const magnitude = quake.properties.mag;
                const place = quake.properties.place;
                const time = new Date(quake.properties.time).toLocaleString();

                const marker = L.marker([lat, lng]).addTo(map).bindPopup(`
                    <b>${place}</b><br>
                    Magnitude: ${magnitude}<br>
                    Time: ${time}<br>
                    <button onclick="zoomIn(${lat}, ${lng})">Zoom In</button>
                    <button onclick="zoomOut()">Return</button>
                `);

                // Add row to the table
                $('#earthquakeTable').append(`
                    <tr class="earthquake-row" data-index="${index}">
                        <td>${place}</td>
                        <td>${magnitude}</td>
                        <td>${time}</td>
                    </tr>
                `);
            });

            // Initialize DataTable
            $('#earthquakeTable').DataTable({
                paging: true,
                pageLength: 10,
                lengthMenu: [5, 10, 20, 50, 100],
                columns: [
                    { title: "Place" },
                    { title: "Magnitude" },
                    { title: "Time" }
                ]
            });

            // Update status bar
            document.getElementById('updateStatus').innerText = 'Last updated: ' + new Date().toLocaleTimeString();
        }

        // Function to zoom in on a marker
        function zoomIn(lat, lng) {
            map.setView([lat, lng], 10);
        }

        // Function to zoom out to the original view
        function zoomOut() {
            map.setView([37.7749, -122.4194], 5);
        }

        // Mousemove event to display latitude and longitude on the status bar
        map.on('mousemove', function(e) {
            document.getElementById('latlong').innerText = `Lat: ${e.latlng.lat.toFixed(4)}, Lng: ${e.latlng.lng.toFixed(4)}`;
        });

        // Initial update
        updateEarthquakeInfo();

        // Update earthquake info every 5 minutes
        setInterval(updateEarthquakeInfo, 300000);
    </script>
