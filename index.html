<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earthquake Map</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .marker { background-image: url('https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png'); background-size: cover; width: 50px; height: 50px; cursor: pointer; }
        .mapboxgl-popup { max-width: 400px; }
        .mapboxgl-popup-content { text-align: center; font-family: 'Open Sans', sans-serif; }
        .status-bar { position: fixed; bottom: 0; width: 100%; background-color: #333; color: white; text-align: center; padding: 10px; }
        .zoom-return { display: none; position: fixed; bottom: 50px; right: 50px; z-index: 1; }
    </style>
</head>
<body>

<div class="container">
    <h1 class="mt-4">Earthquake Information</h1>
    <div class="status-bar" id="status-bar">Loading...</div>
    <div class="zoom-return" id="zoom-return">
        <button class="btn btn-primary">Return</button>
    </div>
    <table class="table table-bordered" id="earthquake-table">
        <thead>
            <tr>
                <th>Location</th>
                <th>Magnitude</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            <!-- Earthquake data will be inserted here -->
        </tbody>
    </table>
</div>
<div id='map'></div>

<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    mapboxgl.accessToken = 'YOUR_MAPBOX_ACCESS_TOKEN';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-98.5795, 39.8283],
        zoom: 3
    });

    const statusBar = document.getElementById('status-bar');
    const zoomReturnBtn = document.getElementById('zoom-return');
    let earthquakeData = [];

    async function fetchEarthquakeData() {
        const response = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson');
        const data = await response.json();
        earthquakeData = data.features;
        updateTable();
        updateMap();
        statusBar.textContent = 'Data loaded';
    }

    function updateTable() {
        const tableBody = document.getElementById('earthquake-table').querySelector('tbody');
        tableBody.innerHTML = '';
        earthquakeData.forEach(earthquake => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${earthquake.properties.place}</td>
                <td>${earthquake.properties.mag}</td>
                <td>${new Date(earthquake.properties.time).toLocaleString()}</td>
            `;
            row.addEventListener('click', () => {
                const coordinates = earthquake.geometry.coordinates;
                map.flyTo({ center: [coordinates[0], coordinates[1]], zoom: 8 });
                zoomReturnBtn.style.display = 'block';
            });
            tableBody.appendChild(row);
        });
    }

    function updateMap() {
        earthquakeData.forEach(earthquake => {
            const coordinates = earthquake.geometry.coordinates;
            const marker = new mapboxgl.Marker({ element: createMarkerElement() })
                .setLngLat([coordinates[0], coordinates[1]])
                .setPopup(new mapboxgl.Popup().setHTML(createPopupContent(earthquake)))
                .addTo(map);
        });
    }

    function createMarkerElement() {
        const el = document.createElement('div');
        el.className = 'marker';
        return el;
    }

    function createPopupContent(earthquake) {
        return `
            <h3>${earthquake.properties.place}</h3>
            <p>Magnitude: ${earthquake.properties.mag}</p>
            <p>Time: ${new Date(earthquake.properties.time).toLocaleString()}</p>
        `;
    }

    map.on('mousemove', (e) => {
        statusBar.textContent = `Lat: ${e.lngLat.lat.toFixed(4)}, Lng: ${e.lngLat.lng.toFixed(4)}`;
    });

    zoomReturnBtn.addEventListener('click', () => {
        map.flyTo({ center: [-98.5795, 39.8283], zoom: 3 });
        zoomReturnBtn.style.display = 'none';
    });

    setInterval(fetchEarthquakeData, 300000);
    fetchEarthquakeData();
</script>

</body>
</html>