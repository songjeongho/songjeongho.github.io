<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Earthquake Information</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 500px; margin-bottom: 10px; }
        #statusBar { position: fixed; bottom: 0; left: 0; width: 100%; background: #333; color: #fff; padding: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .pagination { margin-top: 10px; text-align: center; }
        .pagination button { margin: 0 5px; padding: 5px 10px; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="statusBar">Status: Ready</div>
    <table id="earthquakeTable">
        <thead>
            <tr>
                <th>Time</th>
                <th>Location</th>
                <th>Magnitude</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <div class="pagination">
        <button id="prevPage">Previous</button>
        <button id="nextPage">Next</button>
        <span id="pageInfo"></span>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const map = L.map('map').setView([37.7749, -122.4194], 5); // Initial view set to San Francisco
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            const statusBar = document.getElementById('statusBar');
            const tableBody = document.getElementById('earthquakeTable').getElementsByTagName('tbody')[0];
            const prevPageButton = document.getElementById('prevPage');
            const nextPageButton = document.getElementById('nextPage');
            const pageInfo = document.getElementById('pageInfo');
            let currentPage = 1;
            const rowsPerPage = 20;
            let earthquakes = [];

            map.on('mousemove', function (e) {
                statusBar.textContent = `Lat: ${e.latlng.lat.toFixed(5)}, Lng: ${e.latlng.lng.toFixed(5)}`;
            });

            function fetchEarthquakes() {
                statusBar.textContent = "Status: Fetching earthquake data...";
                fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson')
                    .then(response => response.json())
                    .then(data => {
                        earthquakes = data.features;
                        updateTable();
                        updateMap();
                        statusBar.textContent = "Status: Data fetched successfully";
                    })
                    .catch(error => {
                        console.error("Error fetching earthquake data:", error);
                        statusBar.textContent = "Status: Error fetching data";
                    });
            }

            function updateTable() {
                tableBody.innerHTML = '';
                const start = (currentPage - 1) * rowsPerPage;
                const end = Math.min(start + rowsPerPage, earthquakes.length);

                for (let i = start; i < end; i++) {
                    const quake = earthquakes[i];
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = new Date(quake.properties.time).toLocaleString();
                    row.insertCell(1).textContent = quake.properties.place;
                    row.insertCell(2).textContent = quake.properties.mag;
                    const detailsCell = row.insertCell(3);
                    const detailsButton = document.createElement('button');
                    detailsButton.textContent = 'Details';
                    detailsButton.onclick = () => alert(JSON.stringify(quake.properties, null, 2));
                    detailsCell.appendChild(detailsButton);
                }

                pageInfo.textContent = `Page ${currentPage} of ${Math.ceil(earthquakes.length / rowsPerPage)}`;
            }

            function updateMap() {
                earthquakes.forEach(quake => {
                    const [lng, lat] = quake.geometry.coordinates;
                    const marker = L.marker([lat, lng]).addTo(map);
                    marker.bindPopup(`<b>${quake.properties.place}</b><br>Magnitude: ${quake.properties.mag}`);
                });
            }

            prevPageButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateTable();
                }
            });

            nextPageButton.addEventListener('click', () => {
                if (currentPage * rowsPerPage < earthquakes.length) {
                    currentPage++;
                    updateTable();
                }
            });

            fetchEarthquakes();
            setInterval(fetchEarthquakes, 300000); // Fetch data every 5 minutes
        });
    </script>
</body>
</html>