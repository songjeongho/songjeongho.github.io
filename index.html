<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USGS Earthquake Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-search/2.9.8/leaflet-search.min.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        #map { height: 90vh; }
        #status-bar {
            height: 10vh;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        .spinner-border {
            display: none;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="status-bar" class="d-flex">
        <div>Loading USGS Earthquake Data...</div>
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <div id="latlong">Lat: N/A, Lng: N/A</div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-search/2.9.8/leaflet-search.min.js"></script>
    <script>
        const map = L.map('map').setView([37.7749, -122.4194], 5);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        const earthquakeLayer = L.layerGroup().addTo(map);
        const statusBar = document.getElementById('status-bar');
        const spinner = document.querySelector('.spinner-border');
        const latlong = document.getElementById('latlong');

        const searchControl = new L.Control.Search({
            layer: earthquakeLayer,
            propertyName: 'place',
            moveToLocation: function(latlng, title, map) {
                map.setView(latlng, 10);
            }
        });

        searchControl.addTo(map);

        function updateEarthquakeData() {
            spinner.style.display = 'block';
            fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson')
                .then(response => response.json())
                .then(data => {
                    earthquakeLayer.clearLayers();
                    L.geoJSON(data, {
                        onEachFeature: function (feature, layer) {
                            const { mag, place, time } = feature.properties;
                            layer.bindPopup(`<strong>Location:</strong> ${place}<br><strong>Magnitude:</strong> ${mag}<br><strong>Time:</strong> ${new Date(time)}`);
                            layer.feature = { properties: { place } }; // for search
                        }
                    }).addTo(earthquakeLayer);
                    spinner.style.display = 'none';
                    statusBar.firstChild.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                })
                .catch(error => {
                    console.error('Error fetching earthquake data:', error);
                    spinner.style.display = 'none';
                    statusBar.firstChild.textContent = 'Error loading data';
                });
        }

        map.on('mousemove', function (e) {
            latlong.textContent = `Lat: ${e.latlng.lat.toFixed(5)}, Lng: ${e.latlng.lng.toFixed(5)}`;
        });

        updateEarthquakeData();
        setInterval(updateEarthquakeData, 300000); // update every 5 minutes
    </script>
</body>
</html>